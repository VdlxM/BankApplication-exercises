# This workflow will build a Java project with Maven, and cache/restore any dependencies to improve the workflow execution time
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-java-with-maven

# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

name: Java CI with Maven

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  test:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: maven
      
    - name: Find .java files
        id: find_java
        run: |
          java_files=$(find . -type f -name "*.java")
          if [ -z "$java_files" ]; then
            echo "No .java files found — failing."
            exit 1
          fi
          echo "java_files=$java_files" >> $GITHUB_OUTPUT

      - name: Check for .class files
        run: |
          class_files=$(find . -type f -name "*.class")
          if [ -n "$class_files" ]; then
            echo ".class files detected in the repository (bad practice):"
            echo "$class_files"
            exit 1
          fi

      - name: Generate java-file-report.txt
        run: |
          echo "Java File Report" > java-file-report.txt
          echo "=================" >> java-file-report.txt

          # Count files
          file_count=$(echo ${{ steps.find_java.outputs.java_files }} | wc -w)
          echo "Number of .java files: $file_count" >> java-file-report.txt
          echo "" >> java-file-report.txt

          # Total line count 
          total_lines=0
          echo "Per-file breakdown:" >> java-file-report.txt
          echo "" >> java-file-report.txt

          for file in ${{ steps.find_java.outputs.java_files }}; do
            lines=$(wc -l < "$file")
            total_lines=$((total_lines + lines))
            echo "$file — $lines lines" >> java-file-report.txt
          done

          echo "" >> java-file-report.txt
          echo "Total lines of Java code: $total_lines" >> java-file-report.txt

      - name: Upload report artifact
        uses: actions/upload-artifact@v4
        with:
          name: java-file-report
          path: java-file-report.txt

